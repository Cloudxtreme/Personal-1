---
hosts: all
handlers:
  - name: restart nginx
    action: service name=nginx pattern=/etc/init.d/nginx state=restarted enabled=yes

tasks:

  # Install

  - name: Update apt cache.
    apt: update_cache=yes cache_valid_time=86400
    changed_when: false

  - name: Ensure nginx is installed
    apt: pkg={{ item }} state=present
    with_items:
      - nginx

  # Configure
  - name: Configure nginx.config
    template:
      src: Templates/nginx.conf
      dest: /etc/nginx/nginx.conf owner=root group=root mode=0644
    notify:
      - restart nginx
