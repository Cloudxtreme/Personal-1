---
# tasks file for common

- name: Install essential packages
  apt:
    name: "{{ item }}"
    update_cache: yes
    state: latest
    install_recommends: yes
  with_items:
    - htop
    - git
    - python3
    - python
    - sudo

- name: add group
  group:
    name: admin
    state: present

- name: user/group
  user:
    name: "{{ defaultUserName }}"
    comment: "Adam Elchert"
    groups: admin
    shell: /bin/bash
    state: present

- name: Add admin group to Sudoers
  lineinfile:
      dest: /etc/sudoers
      state: present
      regexp: "{{ item.name }}"
      line: "{{ item.line }}"
  with_items:
    - { name: '^admin', line: 'admin ALL=(ALL:ALL) ALL' }
    - { name: '^aelchert', line: 'aelchert ALL=(ALL:ALL) ALL' }

- name: copy keys to aelchert
  authorized_key:
    user: "{{ item.name }}"
    key: "{{ item.path }}"
  with_file:
    - { name: aelchert, path: templates/keys.keys }
    - { name: root, path: templates/keys.keys }

- name: copy basic bashrc to username root folder
  copy:
    src: /Users/adamschoonover/Git/Personal/Server/AnsiblePlaybooks/roles/common/templates/bashrc
    dest: /home/aelchert/.bashrc
    mode: 0644
